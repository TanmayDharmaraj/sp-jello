var Jello=function(e){var t=this;this.siteUrl=e,this.requestDigest=null;var n=function(){var n=$.Deferred();return t.requestDigest&&t.requestDigest.expiresOn>new Date?n.resolve():($.ajax({type:"POST",url:e+"/_api/contextinfo",headers:{accept:"application/json;odata=verbose"}}).done(function(e){var r=(new Date).getTime();t.requestDigest=e.d.GetContextWebInformation,t.requestDigest.expiresOn=r+1e3*e.d.GetContextWebInformation.FormDigestTimeoutSeconds-6e4,console.log("Token",t.requestDigest.FormDigestValue),n.resolve()}).fail(function(e){console.log("Error fetching Request Digest. Some parts won't work."),n.reject()}),n.promise())};this.Web=function(){throw"Not implemented"},this.List=function(){throw"Not implemented"},this.ListItems=function(r){var i=r.name,o={filter:null,expand:null,select:null,orderBy:null},s=r.contentType,a=function(t){var n=$.Deferred(),r="";return o.select||o.filter||o.expand||o.orderBy?(o.expand&&(r=r.length>0?r+"&"+o.expand:r+"?"+o.expand),o.select&&(r=r.length>0?r+"&"+o.select:r+"?"+o.select),o.filter&&(r=r.length>0?r+"&"+o.filter:r+"?"+o.filter),o.orderBy&&(r=r.length>0?r+"&"+o.orderBy:r+"?"+o.orderBy),t&&(r=r.length>0?r+"&$top="+t:r+"?$top="+t),o={filter:null,expand:null,select:null,orderBy:null}):r=t?"?$top="+t:"",url=e+"/_api/web/lists/getbytitle('"+i+"')/items"+r,$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:url}).done(function(e){e.next=function(){var t=$.Deferred();return a(null,e.d.__next).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},e.prev=function(){var t=$.Deferred();return a(null,e.d.__prev).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},l=function(t){var n=$.Deferred();if(!t)throw"Provided ID is not valid";return $.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+i+"')/items("+t+")"}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},u=function(r){var o=$.Deferred();return n().then(function(){r.__metadata={type:s};var n=JSON.stringify(r);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":t.requestDigest.FormDigestValue},data:n,url:e+"/_api/web/lists/getbytitle('"+i+"')/items"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise()},c=function(r,o){o||(o="*");var s=$.Deferred();return n().then(function(){$.ajax({type:"POST",headers:{"X-RequestDigest":t.requestDigest.FormDigestValue,"X-HTTP-Method":"DELETE","If-Match":o},url:e+"/_api/web/lists/getbytitle('"+i+"')/items("+r+")"}).done(function(e){s.resolve(e)}).fail(function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise()},f=function(r,o,a){a||(a="*");var l=$.Deferred();return n().then(function(){o.__metadata={type:s};var n=JSON.stringify(o);$.ajax({type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":t.requestDigest.FormDigestValue,"X-HTTP-Method":"MERGE","If-Match":a},data:n,url:e+"/_api/web/lists/getbytitle('"+i+"')/items("+r+")"}).done(function(e){l.resolve(e)}).fail(function(e){l.reject(e)})},function(e){l.reject(e)}),l.promise()},p=function(t){var n=$.Deferred();return t=t?"?"+t:"",$.ajax({type:"GET",headers:{accept:"application/json;odata=verbose"},url:e+"/_api/web/lists/getbytitle('"+i+"')/items"+t}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},d=function(e){return o.filter="$filter="+e,this},v=function(e){return o.expand="$expand="+e,this},g=function(e){return o.select="$select="+e,this},h=function(e){return o.orderBy="$orderby="+e,this};return{get:a,getById:l,add:u,remove:c,update:f,query:p,where:d,expand:v,select:g,orderBy:h}}};module.exports=Jello;